2025-10-01 19:21:20,163 - email_module.email_reader - INFO - Loading email configuration from config/email_config.json
2025-10-01 19:21:20,179 - email_module.email_reader - INFO - Connecting to IMAP server...
2025-10-01 19:21:21,501 - email_module.email_reader - INFO - Successfully connected to IMAP server
2025-10-01 19:21:21,501 - email_module.email_reader - INFO - Fetching unread emails from INBOX
2025-10-01 19:21:22,239 - email_module.email_reader - INFO - Found 0 unread email(s)
2025-10-01 19:21:22,914 - email_module.email_reader - INFO - IMAP connection closed
2025-10-01 19:21:22,914 - email_module.email_sender - INFO - Loading email configuration from config/email_config.json
2025-10-01 19:21:22,930 - retriever_module.odoo_connector - INFO - Loading Odoo configuration
2025-10-01 19:21:22,930 - retriever_module.odoo_connector - INFO - Connecting to Odoo API...
2025-10-01 19:21:24,386 - retriever_module.odoo_connector - INFO - Successfully connected to Odoo (UID: 7)
2025-10-01 19:21:24,386 - retriever_module.odoo_connector - INFO - Querying customer info for customer_id=1, email=None
2025-10-01 19:21:25,277 - retriever_module.odoo_connector - INFO - Odoo connection session ended
2025-10-01 19:21:25,280 - orchestrator.claude_agent - INFO - Loading Claude configuration
2025-10-01 19:21:25,284 - orchestrator.claude_agent - INFO - Loading prompt templates...
2025-10-01 19:21:25,284 - orchestrator.claude_agent - WARNING - Claude API key not configured. Running in DEMO mode.
2025-10-01 19:21:25,284 - orchestrator.claude_agent - WARNING - Add your API key to .env file: CLAUDE_API_KEY=sk-ant-...
2025-10-01 19:21:25,284 - orchestrator.claude_agent - INFO - Classifying intent with Claude...
2025-10-01 19:21:25,284 - orchestrator.claude_agent - INFO - Using DEMO intent classification (no Claude API)
2025-10-01 19:21:25,284 - orchestrator.claude_agent - INFO - Extracting entities with Claude...
2025-10-01 19:21:25,284 - orchestrator.claude_agent - INFO - Using DEMO entity extraction (no Claude API)
2025-10-01 19:21:25,365 - email_module.email_reader - INFO - Loading email configuration from config/email_config.json
2025-10-01 19:21:25,365 - email_module.email_reader - INFO - Connecting to IMAP server...
2025-10-01 19:21:27,351 - email_module.email_reader - INFO - Successfully connected to IMAP server
2025-10-01 19:21:27,351 - email_module.email_sender - INFO - Loading email configuration from config/email_config.json
2025-10-01 19:21:27,351 - retriever_module.odoo_connector - INFO - Loading Odoo configuration
2025-10-01 19:21:27,351 - retriever_module.odoo_connector - INFO - Connecting to Odoo API...
2025-10-01 19:21:28,569 - retriever_module.odoo_connector - INFO - Successfully connected to Odoo (UID: 7)
2025-10-01 19:21:28,576 - retriever_module.vector_store - INFO - Loading vector store configuration from config/settings.json
2025-10-01 19:21:28,576 - retriever_module.vector_store - INFO - Initializing faiss vector store...
2025-10-01 19:21:28,576 - orchestrator.claude_agent - INFO - Loading Claude configuration
2025-10-01 19:21:28,576 - orchestrator.claude_agent - INFO - Loading prompt templates...
2025-10-01 19:21:28,576 - orchestrator.claude_agent - WARNING - Claude API key not configured. Running in DEMO mode.
2025-10-01 19:21:28,576 - orchestrator.claude_agent - WARNING - Add your API key to .env file: CLAUDE_API_KEY=sk-ant-...
2025-10-01 19:21:28,576 - orchestrator.processor - INFO - Email Processor initialized
2025-10-01 19:21:28,576 - orchestrator.processor - INFO - Processing email: Order Status Inquiry
2025-10-01 19:21:28,576 - orchestrator.processor - INFO - Classifying email intent...
2025-10-01 19:21:28,576 - orchestrator.claude_agent - INFO - Classifying intent with Claude...
2025-10-01 19:21:28,576 - orchestrator.claude_agent - INFO - Using DEMO intent classification (no Claude API)
2025-10-01 19:21:28,576 - orchestrator.processor - INFO - Detected intent: order_inquiry
2025-10-01 19:21:28,576 - orchestrator.processor - INFO - Extracting entities from email...
2025-10-01 19:21:28,576 - orchestrator.claude_agent - INFO - Extracting entities with Claude...
2025-10-01 19:21:28,576 - orchestrator.claude_agent - INFO - Using DEMO entity extraction (no Claude API)
2025-10-01 19:21:28,576 - orchestrator.processor - INFO - Extracted entities: 12 types
2025-10-01 19:21:28,576 - orchestrator.processor - INFO - Retrieving context from Odoo and vector store...
2025-10-01 19:21:28,576 - retriever_module.odoo_connector - INFO - Querying customer info for customer_id=None, email=test@example.com
2025-10-01 19:21:29,306 - orchestrator.processor - INFO - Retrieving order context...
2025-10-01 19:21:29,306 - retriever_module.odoo_connector - INFO - Searching for reference: SO12345
2025-10-01 19:21:29,778 - orchestrator.processor - INFO - Generating response using Claude agent...
2025-10-01 19:21:29,778 - orchestrator.claude_agent - INFO - Generating response with Claude and RAG context...
2025-10-01 19:21:29,778 - orchestrator.claude_agent - INFO - Using DEMO response generation (no Claude API)
2025-10-01 19:21:29,778 - orchestrator.processor - ERROR - Error generating response: 'NoneType' object has no attribute 'get'
2025-10-01 19:21:29,778 - email_module.email_reader - ERROR - Error closing IMAP connection: command CLOSE illegal in state AUTH, only allowed in states SELECTED
2025-10-01 19:21:29,778 - retriever_module.odoo_connector - INFO - Odoo connection session ended
2025-10-01 19:21:29,778 - retriever_module.vector_store - INFO - Closing vector store...
2025-10-01 19:21:29,778 - retriever_module.vector_store - INFO - Saving vector store index...


============================================================
               RAG EMAIL SYSTEM - TESTS
============================================================

============================================================
TEST 1: Email Connection
============================================================

[1/2] Testing Email Reader (IMAP)...
[OK] Email Reader initialized
[OK] Found 0 unread email(s)

[2/2] Testing Email Sender (SMTP)...
[OK] Email Sender initialized

[PASS] Email connection test PASSED

============================================================
TEST 2: Odoo Connection
============================================================

Connecting to Odoo...
[OK] Connected to Odoo (UID: 7)

Testing customer query...
[OK] Found customer: SDS GmbH

[PASS] Odoo connection test PASSED

============================================================
TEST 3: Claude Agent
============================================================

Initializing Claude agent...
[OK] Claude agent initialized
[INFO] Running in DEMO mode (no API key)

Testing intent classification...
[OK] Intent classified: order_inquiry

Testing entity extraction...
[OK] Entities extracted: 11 types

[PASS] Claude agent test PASSED

============================================================
TEST 4: Complete Workflow
============================================================

Initializing all components...
[OK] All components initialized

Processing mock email...

[OK] Email processed successfully

Intent: order_inquiry
Customer: Unknown

Generated Response Preview:
------------------------------------------------------------
Thank you for your email. We'll get back to you shortly....
------------------------------------------------------------

[PASS] Complete workflow test PASSED

============================================================
TEST SUMMARY
============================================================
[PASS]     Email Connection
[PASS]     Odoo Connection
[PASS]     Claude Agent
[PASS]     Complete Workflow

Total: 4/4 tests passed
Traceback (most recent call last):
  File "C:\Anas's PC\Moaz\New Automation\rag_email_system\test_system.py", line 261, in <module>
    sys.exit(main())
             ^^^^^^
  File "C:\Anas's PC\Moaz\New Automation\rag_email_system\test_system.py", line 251, in main
    print("\n\U0001f389 All tests passed! System is ready to use.")
  File "C:\Users\Anas\AppData\Local\Programs\Python\Python311\Lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'charmap' codec can't encode character '\U0001f389' in position 2: character maps to <undefined>
